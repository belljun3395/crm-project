# 목표 아키텍처

## 상위 수준 다이어그램
```
              ┌──────────────────────┐
              │  도메인 프로듀서     │
              └──────────┬──────────┘
                         │
                ┌────────▼────────┐
                │ 메시징 포트     │  ← 애플리케이션 계층 추상화
                └───────┬─────────┘
        ┌───────────────┴──────────────┐
        │                              │
┌───────▼────────┐             ┌───────▼────────┐
│ SQS 퍼블리셔   │             │ Kafka 퍼블리셔 │
└───────┬────────┘             └───────┬────────┘
        │                                │
┌───────▼────────┐             ┌────────▼───────┐
│ 기존 큐         │             │ Kafka 토픽     │
└───────┬────────┘             └───────┬────────┘
        │                                │
┌───────▼────────┐             ┌────────▼───────┐
│ SQS 컨슈머     │             │ Kafka 컨슈머   │
└───────┬────────┘             └────────┬───────┘
        │                                │
        └─────────────┬──────────────────┘
                      ▼
            다운스트림 서비스
```

## 핵심 구성요소
- **메시징 포트**: 도메인 서비스가 사용하는 프로듀서·컨슈머 인터페이스를 정의해 전송 수단별 코드를 감춥니다.
- **듀얼 퍼블리셔**: 마이그레이션 동안 이벤트를 SQS와 Kafka에 동시에 발행하여 플래그 기반 전환을 지원합니다.
- **브리지 워커**: SQS 큐에서 읽은 메시지를 Kafka로 재전송해 기존 백로그를 미러링하는 전용 리플레이 작업자입니다.
- **Kafka 컨슈머 그룹**: 미러링된 토픽을 소비해 전체 전환 이전에 동작을 검증합니다.
- **DLQ 토픽**: SQS DLQ 동작을 Kafka 토픽으로 재현하고, 선별·재처리용 메타데이터를 명확히 포함합니다.

## 연동 패턴
- 기능 플래그 또는 설정 토글로 트래픽을 한쪽 또는 양쪽 전송 수단에 라우팅해 빠른 롤백을 보장합니다.
- 공용 직렬화 유틸리티를 통해 SQS와 Kafka 간 페이로드 일관성을 유지합니다.
- 재시도 및 백오프 정책을 중앙화해 전송 수단이 달라도 프로듀서·컨슈머 행동을 동일하게 유지합니다.

## 배포 고려사항
- 비즈니스 로직 분기를 방지하기 위해 듀얼 퍼블리셔를 동일 프로세스에서 실행합니다.
- 브리지 워커는 독립적으로 확장 가능한 Spring Batch/Boot 애플리케이션으로 구현할 수 있습니다.
- 애플리케이션 파드에서 Kafka 브로커까지 TLS로 보호된 저지연 네트워크 경로를 확보합니다.
- Terraform 등 IaC 도구로 Kafka 클러스터, 토픽, ACL, 스키마 레지스트리 프로비저닝을 자동화합니다.
