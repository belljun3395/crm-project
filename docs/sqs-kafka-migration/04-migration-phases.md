# 마이그레이션 단계

## Phase 0 — 기반 마련
- Kafka 클러스터(MSK 또는 자가 구축)를 프로덕션 수준 설정으로 프로비저닝합니다.
- Schema Registry, Kafka UI, 모니터링(Prometheus, Grafana)과 알림 체계를 구성합니다.
- 개발·운영 팀을 대상으로 런북과 교육을 제공합니다.

## Phase 1 — 애플리케이션 추상화
- 공유 라이브러리에 `MessagePublisher`, `MessageConsumer` 등 메시징 인터페이스를 도입합니다.
- SQS와 Kafka 전송 어댑터를 구현하고, 프로덕션에서는 플래그를 비활성화한 상태로 유지합니다.
- 하위 환경에서 임베디드 Kafka 또는 Testcontainers를 활용해 통합 테스트를 실행합니다.

## Phase 2 — 듀얼 라이트 & 미러링
- 프로듀서가 SQS와 Kafka에 동시 발행하도록 활성화하고, Kafka 전달 지표를 로깅·모니터링합니다.
- 브리지 워커를 구동해 기존 SQS 트래픽을 Kafka 토픽으로 리플레이하여 이력 동등성을 확보합니다.
- 미러링된 토픽을 처리하는 Kafka 컨슈머 그룹을 띄워 핵심 경로 밖에서 비즈니스 로직을 검증합니다.

## Phase 3 — 통제된 절체
- 기능 플래그 또는 배포 설정을 조정해 컨슈머 트래픽을 점진적으로 Kafka로 전환합니다.
- Lag, 오류율, DLQ 적재량을 모니터링하고 안정성 체크포인트를 통과할 때마다 트래픽 비중을 늘립니다.
- Kafka 경로가 SLA를 충족하면 SQS 발행을 중단하고 브리지 워커를 종료합니다.

## Phase 4 — 종료 및 정리
- 보존 의무를 충족한 뒤 남은 SQS 큐와 DLQ를 아카이브합니다.
- 문서, 런북, 관측성 대시보드를 Kafka 전용 운영 체계로 갱신합니다.
- 마이그레이션 회고를 진행해 학습 내용을 정리하고 개선 기회를 도출합니다.
