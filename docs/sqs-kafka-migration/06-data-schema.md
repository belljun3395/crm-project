# 데이터 및 스키마 전략

## 직렬화 포맷
- Avro 또는 JSON Schema를 표준화해 스키마 진화 보증을 확보합니다.
- 모든 이벤트에 스키마 버전 헤더를 포함해 컨슈머의 하위 호환성을 지원합니다.
- 스키마 등록 전 자동화된 CI 검증을 수행해 런타임 드리프트를 방지합니다.

## 스키마 레지스트리 워크플로
- 토픽(Subject)별 호환성 규칙(Backward 또는 Full)을 정의합니다.
- 배포 파이프라인에서 자동 등록을 수행해 스키마 드리프트를 예방합니다.
- 비즈니스 이벤트와 매핑된 사람이 읽기 쉬운 스키마 카탈로그를 유지합니다.

## 파티션 전략
- 고객 ID, 주문 ID 등 자연스러운 비즈니스 키로 관련 이벤트의 순서를 보장합니다.
- 파티션 편향을 모니터링하고, 핫스팟이 생기면 리밸런스 또는 파티션 수 확장을 진행합니다.
- 멀티 테넌시 순서 요구가 있다면 `tenantId-orderId`와 같은 복합 키를 고려합니다.

## 보존 및 컴팩션
- 다운스트림 리플레이 요구에 맞춰 보존 기간(예: 7~30일)을 설정합니다.
- 중복 제거가 필요하면 집계 상태 토픽에 로그 컴팩션을 활성화합니다.
- 브로커 스토리지 지표를 추적해 보존 설정으로 인한 장애를 방지합니다.

## 백필 및 이력 데이터
- 이력 동등성을 위해 SQS 아카이브나 원본 DB를 Kafka로 적재하는 일회성 배치 작업을 설계합니다.
- 과거 이벤트를 리플레이할 때 라이브 트래픽과 구분할 수 있도록 출처 메타데이터를 기록합니다.
- 리플레이가 분석 지표를 왜곡하지 않도록 데이터 팀과 사전 조율합니다.
